(this.webpackJsonpmessages=this.webpackJsonpmessages||[]).push([[0],{36:function(e,t,n){e.exports=n(55)},41:function(e,t,n){},55:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(20),u=n.n(s),o=(n(41),n(5)),i=n.n(o),c=n(10),l=n(6),p=n(7),d=n(9),m=n(8),h=n(1),f=n(2);function g(){var e=Object(h.a)(["\n    display: flex;\n    justify-content: center;\n    &:hover{\n        cursor: pointer\n    }\n"]);return g=function(){return e},e}function v(){var e=Object(h.a)(["\n    color: white;\n    padding-right: 20px;\n    &:hover{\n        cursor: pointer\n    }\n"]);return v=function(){return e},e}var b=f.a.div(v()),x=f.a.div(g()),R=function(e){return r.a.createElement(x,null,r.a.createElement(b,{onClick:function(){return e.isChat(!0,!1)}},"Inbox"),r.a.createElement(b,{onClick:function(){return e.isChat(!1,!0)}},"Chat"))},E=n(16),O=n.n(E),y=(n(24),n(25),n(47),O.a.initializeApp({apiKey:"AIzaSyDVflBKJPhm5bNZfYL5yoqT66NfyiPQgT0",authDomain:"messages-598f6.firebaseapp.com",databaseURL:"https://messages-598f6.firebaseio.com",projectId:"messages-598f6",storageBucket:"messages-598f6.appspot.com",messagingSenderId:"1044285096751",appId:"1:1044285096751:web:f00b017ec43ce7dd2557da",measurementId:"G-KRSD66CD2T"}).firestore(),new O.a.auth.GoogleAuthProvider),I=O.a.auth(),w=O.a;function D(){var e=Object(h.a)(["\n    &:hover {\n        cursor: pointer\n    }\n"]);return D=function(){return e},e}function j(){var e=Object(h.a)(["\n    height: 5vh;\n    width: 93%;\n    background-color: grey;\n    border: none;\n    color: white;\n"]);return j=function(){return e},e}function M(){var e=Object(h.a)(["\n    margin-top: 10px;\n    display: flex;\n    width: 100%;\n"]);return M=function(){return e},e}var S=f.a.div(M()),C=f.a.textarea(j()),A=f.a.button(D()),_=n(4),U=function(e){return function(t){t({type:"IS_MESSAGES_LOADING",payload:e})}},k=function(e){return function(t){t({type:"LOAD_MESSAGES_TEXT",payload:e})}},L=function(e){return function(t){t({type:"PREVENT_SCROLL_DOWN",payload:e})}},T=function(e){return function(t){t({type:"ADD_QUANTITY_LOAD_MESSAGES",payload:e})}},N=function(e){return function(t){t({type:"ADD_MESSAGES",payload:e})}},q=function(e){return function(t){t({type:"ADD_ALL_CURRENT_USER_IDS",payload:e})}},B=function(e){return function(t){t({type:"ADD_ALL_CURRENT_USER_EMAILS",payload:e})}},G=function(e){return function(t){t({type:"ADD_ALL_USER_EMAILS",payload:e})}},P=function(e){return function(t){t({type:"ADD_NEW_MESSAGE_OTHER_USER_EMAIL",payload:e})}},F=function(e){return function(t){t({type:"ADD_EMAIL",payload:e})}},W=function(e){return function(t){t({type:"ADD_CURRENT_CHAT_ID",payload:e})}},Q=function(e){return function(t){t({type:"ADD_USER",payload:e})}},V=function(e){return function(t){t({type:"ADD_USERID",payload:e})}},X=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={message:""},e.submitFunction=function(){var t,n,a,r,s,u;w.database().ref("users").once("value",(function(t){var n=e.props.allUserEmailsRedux.indexOf(e.props.newMessageOtherUserEmailRedux),o=Object.keys(t.val());a=o[n],-1!==n&&(r=t.val()[a].name,s=t.val()[a].photoURL,u=t.val()[a].email)}));var o=w.database().ref("users/".concat(e.props.userID,"/messages")),i=w.database().ref("users/".concat(a,"/messages"));if(0===e.props.messagesRedux.length){var c=w.database().ref("messages"),l={lastMessage:Date.now(),user1Photo:s,user2Photo:e.props.userRedux.photoURL,user1Email:u,user2Email:e.props.userRedux.email,user1:r,user2:e.props.userRedux.displayName,request:u,requestStatus:"pending"};c.push(l).then((function(a){n=a.path.pieces_.pop(),e.props.dispatch(W(n)),o.push({messageID:n,lastMessage:Date.now()}),i.push({messageID:n,lastMessage:Date.now()}),(t=w.database().ref("messages/".concat(n))).update({lastMessage:Date.now()});var r={user:e.props.usernameState,message:e.state.message,read:!1,email:e.props.emailRedux,sent:Date.now()};t.push(r),document.getElementById("message-input").value=""}))}else{if(/^(?!\s*$).+/.test(e.state.message)){(t=w.database().ref("messages/".concat(e.props.currentChatIDRedux))).once("value",(function(t){var n=t.val();n=Object.values(n),e.props.emailRedux!==n[n.length-2]?u=n[n.length-2]:e.props.emailRedux!==n[n.length-5]&&(u=n[n.length-5])})),e.props.dispatch(T(1));var p={user:e.props.usernameState,message:e.state.message,read:!1,email:e.props.emailRedux,sent:Date.now()};t.push(p),t.update({lastMessage:Date.now()}),w.database().ref("users").once("value",(function(e){for(var t in e.val())e.val()[t].email===u&&(a=t)})),o.once("value",(function(t){var n=t.val();for(var a in n){if(n[a].messageID===e.props.currentChatIDRedux)w.database().ref("users/".concat(e.props.userID,"/messages/").concat(a)).update({lastMessage:Date.now()})}})),(i=w.database().ref("users/".concat(a,"/messages"))).once("value",(function(t){for(var n in t.val()){if(t.val()[n].messageID===e.props.currentChatIDRedux)w.database().ref("users/".concat(a,"/messages/").concat(n)).update({lastMessage:Date.now()})}})),w.database().ref("users/".concat(e.props.userID)).update({lastUpdated:Date.now()}),e.setState({message:""}),document.getElementById("message-input").value=""}}},e.submitFunctionAsync=function(){(function(){var t=Object(c.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.submitFunction();case 2:return t.next=4,e.props.getMessages(e.props.currentChatIDRedux);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()},e.submit=function(t){t.keyCode?13!==t.keyCode||t.shiftKey||(t.preventDefault(),e.submitFunctionAsync()):e.submitFunctionAsync()},e.handleMessageChange=function(t){e.setState({message:t.target.value})},e.clearUnread=function(t){e.props.messagesRedux.length>0&&w.database().ref("messages/".concat(t)).once("value",(function(n){var a=n.val(),r=Object.keys(a),s=Object.values(a);r.reverse().splice(0,9),s.reverse().splice(0,9);for(var u=0,o=0,i=s;o<i.length;o++){var c=i[o];if(!1!==c.read)break;c.email!==e.props.emailRedux&&(w.database().ref("messages/".concat(t,"/").concat(r[u])).update({read:!0,readTime:Date.now()}),u++)}}))},e}return Object(p.a)(n,[{key:"render",value:function(){var e=this;return r.a.createElement(S,null,r.a.createElement(C,{className:"br3",onClick:function(){return e.clearUnread(e.props.currentChatIDRedux)},id:"message-input",onChange:this.handleMessageChange,placeholder:"enter message"}),r.a.createElement(A,{onClick:this.submit},"Send"))}},{key:"componentDidMount",value:function(){document.addEventListener("keypress",this.submit)}}]),n}(a.Component),z=Object(_.b)((function(e){return{messagesRedux:e.app.messagesRedux,emailRedux:e.app.emailRedux,allUserEmailsRedux:e.app.allUserEmailsRedux,currentChatIDRedux:e.app.currentChatIDRedux,newMessageOtherUserEmailRedux:e.app.newMessageOtherUserEmailRedux,userID:e.app.userID,userRedux:e.app.userRedux}}))(X);function H(){var e=Object(h.a)(["\n    font-size: 10px;\n"]);return H=function(){return e},e}function K(){var e=Object(h.a)(["\n    margin-top: 1rem;\n    background: rgb(70,70,70);\n    visibility: ",";\n"]);return K=function(){return e},e}function J(){var e=Object(h.a)(["\n    color: white;\n    border: none;\n    background-color: rgb(45, 45, 45);\n    &:hover {\n        cursor:pointer\n    }\n"]);return J=function(){return e},e}function Y(){var e=Object(h.a)(["\n    display: flex;\n    flex-direction: column;\n"]);return Y=function(){return e},e}function $(){var e=Object(h.a)(["\n    color: white;\n"]);return $=function(){return e},e}function Z(){var e=Object(h.a)(["\n    color: white;\n    background-color: ",";\n    border: rgb(20,20,20) solid 1px;\n    max-width: 45%;\n    min-width: 15%;\n    word-wrap:break-word;\n    &:hover {\n        cursor: pointer\n    }\n"]);return Z=function(){return e},e}function ee(){var e=Object(h.a)(["\n    display: flex;\n    flex-direction: ",";\n    align-items: center;\n"]);return ee=function(){return e},e}var te=f.a.div(ee(),(function(e){return e.isCurrentUser?"row-reverse":"row"})),ne=f.a.div(Z(),(function(e){return e.isCurrentUser?"rgb(45, 45, 45)":"rgb(80, 80, 80)"})),ae=f.a.div($()),re=f.a.div(Y()),se=f.a.button(J()),ue=f.a.div(K(),(function(e){return e.showOptions?"null":"hidden"})),oe=f.a.div(H()),ie=n(27),ce=n.n(ie),le=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={showOptions:!1},e.show=function(){e.setState({showOptions:!0})},e.hide=function(){e.setState({showOptions:!1})},e}return Object(p.a)(n,[{key:"render",value:function(){var e=this;return this.props.message?r.a.createElement(te,{onMouseLeave:this.hide,isCurrentUser:this.props.emailRedux===this.props.email},r.a.createElement(ne,{isCurrentUser:this.props.emailRedux===this.props.email,onClick:this.show,className:this.props.user===this.props.userMessage?"current-user grow br3 pa3 ma1 dib bw2 shadow-5":"other-user grow br3 pa3 ma2 dib bw2 shadow-5"},"lastMessage"!==this.props.itemID&&"user1"!==this.props.itemID&&"user2"!==this.props.itemID&&"user2Photo"!==this.props.itemID&&"user1Photo"!==this.props.itemID&&"user2Email"!==this.props.itemID&&"user1Email"!==this.props.itemID?r.a.createElement("div",null,this.props.message,this.props.index===this.props.messagesQuantity-10&&this.props.readTime>0&&this.props.email===this.props.emailRedux?r.a.createElement(oe,null,"Seen ",ce.a.unix(this.props.readTime/1e3).calendar().toLowerCase()):null):null),r.a.createElement(ue,{isCurrentUser:this.props.emailRedux===this.props.email,className:"br3 pa2 ma1 dib shadow-5",showOptions:this.state.showOptions},this.props.emailRedux===this.props.email?r.a.createElement(se,{onClick:function(){return e.props.removeItem(e.props.itemID)}},"Delete"):null,r.a.createElement("div",null,ce.a.unix(Number(this.props.sent)/1e3).calendar()))):null}}]),n}(a.Component),pe=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).removeItem=function(t){w.database().ref("/messages/".concat(e.props.currentChatIDRedux,"/").concat(t)).remove()},e}return Object(p.a)(n,[{key:"render",value:function(){var e=this;return r.a.createElement(re,null,"NEW MESSAGE"===this.props.currentChatIDRedux?r.a.createElement(ae,null,"Send new message to: ",this.props.newMessageOtherUserEmailRedux):null,this.props.messagesRedux.map((function(t,n){return r.a.createElement(le,{messagesQuantity:e.props.messagesRedux.length,index:n,readTime:t.readTime,emailRedux:e.props.emailRedux,removeItem:e.removeItem,key:n,message:t.message,email:t.email,userMessage:t.user,itemID:t.itemId,sent:t.sent})})))}}]),n}(a.Component),de=Object(_.b)((function(e){return{messagesRedux:e.app.messagesRedux,emailRedux:e.app.emailRedux,currentChatIDRedux:e.app.currentChatIDRedux,newMessageOtherUserEmailRedux:e.app.newMessageOtherUserEmailRedux,isMesssagesLoading:e.app.isMesssagesLoading}}))(pe),me=function(e){return r.a.createElement("div",{style:{overflow:"scroll",border:"5px black",height:e.height,display:e.display,flexDirection:e.flexDirection}},e.children)};function he(){var e=Object(h.a)(["\n    color: white;\n    background-color: rgb(40,40,40);\n    border: none;\n    &:hover {\n        cursor: pointer\n    }\n"]);return he=function(){return e},e}function fe(){var e=Object(h.a)(["\n    display: flex;\n    justify-content: center;\n"]);return fe=function(){return e},e}function ge(){var e=Object(h.a)(["\n    @media (max-width: 900px){\n        height: 81vh;\n        width: 100vw;\n    }\n    @media (min-width: 900px){\n        height: 81vh;\n        width: 55vw;\n    }\n    @media (min-width: 1100px){\n        height: 81vh;\n        width: 700px;\n    }\n    border: 5px solid rgb(30,30,30);\n"]);return ge=function(){return e},e}var ve=f.a.div(ge()),be=f.a.div(fe()),xe=f.a.button(he()),Re=function(e){return function(t){t({type:"IS_INBOX_TAB",payload:e})}},Ee=function(e){return function(t){t({type:"ADD_ALL_INFO_INBOX",payload:e})}},Oe=function(e){return function(t){t({type:"ADD_REQUEST_COUNT",payload:e})}},ye=function(e){return function(t){t({type:"IS_MESSAGE_REQUEST",payload:e})}};function Ie(){var e=Object(h.a)(["\n    background-color: rgb(40,40,40);\n    color: white;\n    border: none;\n    justify-content: center;\n    &:hover{\n        cursor:pointer\n    }\n"]);return Ie=function(){return e},e}function we(){var e=Object(h.a)(["\n    background-color: rgb(40,40,40);\n    color: white;\n    border: none;\n    justify-content: center;\n    &:hover{\n        cursor:pointer\n    }\n"]);return we=function(){return e},e}function De(){var e=Object(h.a)(["\n    display: flex;\n    width: 50vw;\n"]);return De=function(){return e},e}var je=f.a.div(De()),Me=f.a.button(we()),Se=f.a.button(Ie()),Ce=Object(_.b)((function(e){return{currentChatIDRedux:e.app.currentChatIDRedux,userID:e.app.userID,messagesRedux:e.app.messagesRedux,emailRedux:e.app.emailRedux}}))((function(e){var t=function(t){var n;w.database().ref("messages/".concat(e.currentChatIDRedux)).update({requestStatus:t}),w.database().ref("users/".concat(e.userID)).update({lastUpdated:Date.now()}),"accepted"===t?(e.dispatch(Re(!0)),e.dispatch(ye(!1)),n=e.currentChatIDRedux,e.messagesRedux.length>0&&w.database().ref("messages/".concat(n)).once("value",(function(t){var a=t.val(),r=Object.keys(a),s=Object.values(a);r.reverse().splice(0,9),s.reverse().splice(0,9);for(var u=0,o=0,i=s;o<i.length;o++){var c=i[o];if(!1!==c.read)break;c.email!==e.emailRedux&&(w.database().ref("messages/".concat(n,"/").concat(r[u])).update({read:!0,readTime:Date.now()}),u++)}}))):(e.dispatch(N([])),e.dispatch(W(null)))};return r.a.createElement(je,null,r.a.createElement(Me,{onClick:function(){return t("rejected")},className:"br2"},"Delete"),r.a.createElement(Se,{onClick:function(){return t("accepted")},className:"br2"},"Accept"))})),Ae=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).loadMoreMessages=function(){(function(){var t=Object(c.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.props.dispatch(L(!0));case 2:return t.next=4,e.props.dispatch(T(15));case 4:return t.next=6,e.props.getMessages(e.props.currentChatIDRedux);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()},e}return Object(p.a)(n,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(ve,{className:"message-container"},r.a.createElement(me,{height:"79vh"},this.props.messagesRedux.length>23?r.a.createElement(be,null,r.a.createElement(xe,{onClick:this.loadMoreMessages},this.props.loadMessagesText)):null,r.a.createElement(de,{removeItem:this.props.removeItem,user:this.props.usernameState}),r.a.createElement("div",{id:"scroll-here"}))),null!==this.props.currentChatIDRedux?this.props.isMessageRequest?r.a.createElement(Ce,null):r.a.createElement(z,{newMessageRoute:this.props.newMessageRoute,usernameState:this.props.usernameState,getMessages:this.props.getMessages,usernameFunc:this.props.username}):null)}}]),n}(a.Component),_e=Object(_.b)((function(e){return{currentChatIDRedux:e.app.currentChatIDRedux,messagesRedux:e.app.messagesRedux,isMessageRequest:e.requests.isMessageRequest,loadMessagesText:e.app.loadMessagesText}}))(Ae),Ue=n(13);function ke(){return(ke=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Le(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var Te=r.a.createElement("circle",{cx:20,cy:20,r:16,fill:"rgb(26, 26, 26)"}),Ne=function(e){var t=e.svgRef,n=e.title,a=Le(e,["svgRef","title"]);return r.a.createElement("svg",ke({height:40,width:40,ref:t},a),n?r.a.createElement("title",null,n):null,Te)},qe=r.a.forwardRef((function(e,t){return r.a.createElement(Ne,ke({svgRef:t},e))}));n.p;function Be(){var e=Object(h.a)(["\n    position: absolute;\n"]);return Be=function(){return e},e}function Ge(){var e=Object(h.a)(["\n\n"]);return Ge=function(){return e},e}function Pe(){var e=Object(h.a)(["\n    float: right;\n    width: 25%;\n    position: relative;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n"]);return Pe=function(){return e},e}function Fe(){var e=Object(h.a)(["\n    word-wrap:break-word;\n"]);return Fe=function(){return e},e}function We(){var e=Object(h.a)(["\n    font-size: 20px;\n"]);return We=function(){return e},e}function Qe(){var e=Object(h.a)(["\n    float: left;\n    width: 50%;\n    height: 50%;\n"]);return Qe=function(){return e},e}function Ve(){var e=Object(h.a)(["\n    padding-left: 10px;\n    height: 60px;\n    width: 60px;\n"]);return Ve=function(){return e},e}function Xe(){var e=Object(h.a)(["\n    width: 25%;\n    float: left;\n    align-items: center;\n"]);return Xe=function(){return e},e}function ze(){var e=Object(h.a)(["\n    height: 90px;\n    cursor: pointer;\n    border: solid rgb(5,5,5) 1px;\n    background-color: "," ;\n    color: white;\n    display: flex;\n    width: 97%;\n"]);return ze=function(){return e},e}var He=f.a.div(ze(),(function(e){return e.isCurrentThread?"rgb(100,100,100) ":"rgb(40,40,40)"})),Ke=f.a.div(Xe()),Je=f.a.img(Ve()),Ye=f.a.div(Qe()),$e=f.a.div(We()),Ze=f.a.div(Fe()),et=f.a.div(Pe()),tt=(Object(f.a)(qe)(Ge()),f.a.div(Be())),nt=function(e,t){var n=0;return e.lastMessage<t.lastMessage?n=1:e.lastMessage>t.lastMessage&&(n=-1),n},at=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={messages:[],allInfo:[]},e.getMessageSummaries=function(){var t=w.auth().currentUser;w.database().ref("users/".concat(t.uid)).on("value",(function(n){var a=n.val();a&&a.messages&&function(){var n=Object.values(a.messages);n=n.sort(nt);var r,s=[],u=[],o=[],i=[],c={},l=Object(Ue.a)(n);try{var p=function(){var n=r.value,a=0,l=w.database().ref("messages/".concat(n.messageID)),p=void 0;l.on("value",(function(r){if(r.val()){var l={};p=Object.values(r.val());var d=Object.values(r.val());d.reverse().splice(0,9);for(var m=0,h=0,f=d;h<f.length;h++){var g=f[h];if(!1!==g.read)break;g.email!==t.email&&m++}var v,b,x=Object.values(r.val());v=x[x.length-3]===t.displayName?x[x.length-6]:x[x.length-3],b=x[x.length-1]===t.photoURL?x[x.length-4]:x[x.length-1],x[x.length-2]===t.email?i.push(x[x.length-5]):i.push(x[x.length-2]),(p=p[p.length-10])&&(p=Object.values(p)[1]).length+p.split(" ").length>31&&(p=p.slice(0,31),p+="..."),o.push(n.messageID),l.message=p,l.photoURL=b,l.displayName=v,l.unread=m,"accepted"!==r.val().requestStatus&&r.val().request===e.props.emailRedux||(c[n.messageID]=l,e.setState({allInfo:c}),e.props.dispatch(Ee(c)),s.push(n.messageID)),r.val().request===e.props.emailRedux&&"pending"===r.val().requestStatus?u.push(n.messageID):a>-1?null===e.props.currentChatIDRedux&&("rejected"===r.val().requestStatus&&r.val().request===e.props.emailRedux||(e.props.newMessageRoute(n.messageID),a=-1)):a++,e.props.dispatch(Oe(u.length))}})),e.props.dispatch(B(i)),e.props.dispatch(q(o))};for(l.s();!(r=l.n()).done;)p()}catch(d){l.e(d)}finally{l.f()}e.props.messagesRedux.length>=s.length+u.length&&document.getElementById("scroll-here")&&document.getElementById("scroll-here").scrollIntoView(),e.setState({messages:s})}()}))},e.test=function(){console.log(Object.values(e.state.allInfo))},e.inboxToMessages=function(t){e.props.newMessageRoute(t),w.database().ref("messages/".concat(t)).on("value",(function(n){if(n.val()){var a=n.val(),r=Object.keys(a),s=Object.values(a);r.reverse().splice(0,8),s.reverse().splice(0,8),s.map((function(n,a){!1===n.read&&(n.email!==e.props.emailRedux&&w.database().ref("messages/".concat(t,"/").concat(r[a])).update({read:!0,readTime:Date.now()}));return null})),document.getElementById("scroll-here").scrollIntoView()}}))},e.inboxToMessagesAsync=function(t){(function(){var n=Object(c.a)(i.a.mark((function n(){return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.props.dispatch(ye(!1));case 2:return n.next=4,e.inboxToMessages(t);case 4:return n.next=6,document.getElementById("scroll-here").scrollIntoView();case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}})()()},e.getMessageSummariesAsync=function(){(function(){var t=Object(c.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.props.dispatch(Oe(0));case 2:return t.next=4,e.getMessageSummaries();case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()},e}return Object(p.a)(n,[{key:"componentDidMount",value:function(){this.getMessageSummariesAsync()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,Object.values(this.props.allInfoInbox).map((function(t,n){return r.a.createElement(He,{className:"br3 pa3 ma2",isCurrentThread:e.props.currentChatIDRedux===e.state.messages[n],onClick:function(){return e.inboxToMessagesAsync(e.state.messages[n])},key:n},r.a.createElement(Ke,null,r.a.createElement(Je,{alt:"user profile",src:t.photoURL})),r.a.createElement(Ye,null,r.a.createElement($e,null,t.displayName),r.a.createElement(Ze,null,t.message)),t.unread>0?r.a.createElement(et,null,r.a.createElement(qe,null),r.a.createElement(tt,null,t.unread)):null)})))}}]),n}(a.Component),rt=Object(_.b)((function(e){return{currentChatIDRedux:e.app.currentChatIDRedux,emailRedux:e.app.emailRedux,isInboxTab:e.inbox.isInboxTab,requestCount:e.requests.requestCount,allInfoInbox:e.inbox.allInfoInbox,messagesRedux:e.app.messagesRedux,userRedux:e.app.userRedux}}))(at),st=function(e,t){var n=0;return e.lastMessage<t.lastMessage?n=1:e.lastMessage>t.lastMessage&&(n=-1),n},ut=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={messages:[],allInfo:[]},e.getMessageSummaries=function(){var t=w.auth().currentUser;w.database().ref("users/".concat(t.uid)).on("value",(function(n){var a=n.val();a&&a.messages&&function(){var n=Object.values(a.messages);n=n.sort(st);var r,s=[],u=[],o=[],i={},c=Object(Ue.a)(n);try{var l=function(){var n=r.value,a=w.database().ref("messages/".concat(n.messageID)),c=void 0;a.on("value",(function(a){if(a.val()){var r={};c=Object.values(a.val());var l,p,d=Object.values(a.val());d[d.length-3]===t.displayName?l=d[d.length-6]:d[d.length-6]===t.displayName&&(l=d[d.length-3]),d[d.length-1]===t.photoURL?p=d[d.length-4]:d[d.length-4]===t.photoURL&&(p=d[d.length-1]),d[d.length-2]===t.email?o.push(d[d.length-5]):d[d.length-5]===t.email&&o.push(d[d.length-2]),(c=c[c.length-10])&&(c=Object.values(c)[1]).length+c.split(" ").length>31&&(c=c.slice(0,31),c+="..."),u.push(n.messageID),r.message=c,r.photoURL=p,r.displayName=l,r.unread=0,a.val().request===e.props.emailRedux&&"pending"===a.val().requestStatus&&(i[n.messageID]=r,e.setState({allInfo:i}),s.push(n.messageID))}document.getElementById("scroll-here")&&document.getElementById("scroll-here").scrollIntoView()})),e.props.dispatch(B(o)),e.props.dispatch(q(u))};for(c.s();!(r=c.n()).done;)l()}catch(p){c.e(p)}finally{c.f()}e.setState({messages:s})}()}))},e.test=function(){},e.inboxToMessagesAsync=function(t){(function(){var n=Object(c.a)(i.a.mark((function n(){return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.props.dispatch(ye(!0));case 2:return n.next=4,e.props.newMessageRoute(t);case 4:return n.next=6,document.getElementById("scroll-here").scrollIntoView();case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}})()()},e}return Object(p.a)(n,[{key:"componentDidMount",value:function(){this.getMessageSummaries()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,this.state.messages.length>0?r.a.createElement("div",null,this.props.isInboxTab?r.a.createElement("div",null,"Hellooo"):Object.values(this.state.allInfo).map((function(t,n){return r.a.createElement(He,{className:"br3 pa3 ma2",isCurrentThread:e.props.currentChatIDRedux===e.state.messages[n],onClick:function(){return e.inboxToMessagesAsync(e.state.messages[n])},key:n},r.a.createElement(Ke,null,r.a.createElement(Je,{alt:"user profile",src:t.photoURL})),r.a.createElement(Ye,null,r.a.createElement($e,null,t.displayName),r.a.createElement(Ze,null,t.message)))}))):null)}}]),n}(a.Component),ot=Object(_.b)((function(e){return{currentChatIDRedux:e.app.currentChatIDRedux,emailRedux:e.app.emailRedux,isInboxTab:e.inbox.isInboxTab}}))(ut);function it(){var e=Object(h.a)(["\n    &:hover {\n        cursor: pointer;\n    };\n    text-decoration: ","\n"]);return it=function(){return e},e}function ct(){var e=Object(h.a)(["\n    &:hover {\n        cursor: pointer\n    };\n    text-decoration: ","\n"]);return ct=function(){return e},e}function lt(){var e=Object(h.a)(["\n    display: flex;\n    color: white;\n    justify-content: space-evenly;\n"]);return lt=function(){return e},e}function pt(){var e=Object(h.a)(["\n    @media (max-width: 900px) {\n        width: 100vw;\n        height: 86vh; \n    }\n    @media (min-width: 900px) {\n        width: 400px;\n        height: 200px; \n    }\n"]);return pt=function(){return e},e}var dt=f.a.div(pt()),mt=f.a.div(lt()),ht=f.a.div(ct(),(function(e){return e.isSelected?"underline":"null"})),ft=f.a.div(it(),(function(e){return e.isSelected?"null":"underline"})),gt=Object(_.b)((function(e){return{isInboxTab:e.inbox.isInboxTab,requestCount:e.requests.requestCount}}))((function(e){return r.a.createElement("div",null,r.a.createElement(mt,null,r.a.createElement(ht,{isSelected:e.isInboxTab,onClick:function(){return e.dispatch(Re(!0))}},"Inbox"),r.a.createElement(ft,{isSelected:e.isInboxTab,onClick:function(){return e.dispatch(Re(!1))}},"Requests (",e.requestCount,")")),e.isInboxTab?r.a.createElement(me,{height:"88vh"},r.a.createElement(dt,null,r.a.createElement(rt,{newMessageRoute:e.newMessageRoute}))):r.a.createElement(me,{height:"88vh"},r.a.createElement(dt,null,r.a.createElement(ot,{newMessageRoute:e.newMessageRoute}))))}));function vt(){var e=Object(h.a)(["\n    color: white;\n"]);return vt=function(){return e},e}function bt(){var e=Object(h.a)(["\n    height: 30px;\n    width: 200px;\n    cursor: pointer;\n    background-color: gray;\n    color: white;\n    border: none;\n    margin: 0 5px 0 10px;\n"]);return bt=function(){return e},e}function xt(){var e=Object(h.a)(["\n    height: 35px;\n    width: 40px;\n    cursor: pointer;\n    background-color: rgb(50,50,50);\n    color: white;\n    border: none;\n"]);return xt=function(){return e},e}var Rt=f.a.button(xt()),Et=f.a.input(bt()),Ot=f.a.div(vt()),yt=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={email:"",isUserExist:""},e.handleEmail=function(t){e.setState({email:t.target.value})},e.createNewMessage=function(){if(e.state.email.length>0){var t=e.props.allCurrentUserEmailsRedux.indexOf(e.state.email);if(-1!==t)e.props.getMessages(e.props.allCurrentUserIDsRedux[t]),e.props.dispatch(W(e.props.allCurrentUserIDsRedux[t])),"user does not exist"===e.state.isUserExist&&e.setState({isUserExist:""});else{var n,a=Object(Ue.a)(e.props.allUserEmailsRedux);try{for(a.s();!(n=a.n()).done;){var r=n.value;if(e.state.email===e.props.emailRedux)break;if(r===e.state.email){e.props.dispatch(N([])),e.props.dispatch(W("NEW MESSAGE")),e.props.dispatch(P(e.state.email)),e.setState({isUserExist:""});break}e.setState({isUserExist:"user does not exist"})}}catch(s){a.e(s)}finally{a.f()}}document.getElementById("email-input").value=""}},e}return Object(p.a)(n,[{key:"render",value:function(){return r.a.createElement(Ot,null,r.a.createElement(Et,{className:"br2",id:"email-input",onChange:this.handleEmail,placeholder:"enter email"}),r.a.createElement(Rt,{className:"br2",onClick:this.createNewMessage},"+"),r.a.createElement("div",null,this.state.isUserExist))}}]),n}(a.Component),It=Object(_.b)((function(e){return{allUserEmailsRedux:e.app.allUserEmailsRedux,emailRedux:e.app.emailRedux,allCurrentUserEmailsRedux:e.app.allCurrentUserEmailsRedux,allCurrentUserIDsRedux:e.app.allCurrentUserIDsRedux}}))(yt);function wt(){var e=Object(h.a)(["\n    @media (max-width: 900px) {\n        display: none;\n    }\n    display: flex;\n"]);return wt=function(){return e},e}function Dt(){var e=Object(h.a)(["\n"]);return Dt=function(){return e},e}function jt(){var e=Object(h.a)(["\n    font-size: 6vw;\n    color: white;\n    font-family: 'Lato';\n    position: absolute;\n    top: 45%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n"]);return jt=function(){return e},e}function Mt(){var e=Object(h.a)(["\n    display: flex;\n"]);return Mt=function(){return e},e}function St(){var e=Object(h.a)(["\n    border: none;\n    height: 5vh;\n    width: 20vw;\n    color: white;\n    cursor: pointer;\n    background-color: rgb(18, 208, 255);\n    position: absolute;\n    top: 55%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    font-family: 'Lato';\n    font-size: 2vw;\n    &:hover {\n        background-color: green;\n    }\n"]);return St=function(){return e},e}function Ct(){var e=Object(h.a)(["\n    border: none;\n    color: white;\n    cursor: pointer;\n    background-color: rgb(80, 80, 80);\n    margin: 5px 5px 5px 10px;\n"]);return Ct=function(){return e},e}function At(){var e=Object(h.a)(["\n    width: 100%;\n"]);return At=function(){return e},e}function _t(){var e=Object(h.a)(["\n    @media (min-width: 900px) {\n        display: none;\n    }\n"]);return _t=function(){return e},e}function Ut(){var e=Object(h.a)(["\n    @media (min-width: 900px){\n        display: none;\n    }\n"]);return Ut=function(){return e},e}var kt=f.a.div(Ut()),Lt=f.a.div(_t()),Tt=f.a.div(At()),Nt=f.a.button(Ct()),qt=f.a.button(St()),Bt=f.a.div(Mt()),Gt=f.a.div(jt()),Pt=f.a.div(Dt()),Ft=f.a.div(wt()),Wt=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={username:"",showLogInButton:!1,isMessagesLoading:!0,isChat:!0},e.username=function(t){e.setState({username:t.target.value})},e.stayLoggedIn=function(){I.onAuthStateChanged((function(t){t?(e.setState({username:t.displayName}),e.props.dispatch(F(t.email)),e.props.dispatch(V(t.uid)),e.props.dispatch(Q(t)),e.getUserInfo()):e.setState({showLogInButton:!0})}))},e.getUserInfo=function(){w.database().ref("users").on("value",(function(t){var n=t.val(),a=[];for(var r in n)a.push(n[r].email);e.props.dispatch(G(a))}))},e.addUserData=function(e,t,n,a){var r={name:e,email:t,dateCreated:Date.now(),photoURL:a};w.database().ref("users/".concat(n)).set(r)},e.removeItem=function(t){w.database().ref("/messages/".concat(e.props.currentChatIDRedux,"/").concat(t)).remove()},e.logout=function(){I.signOut(),e.props.dispatch(N([])),e.props.dispatch(q([])),e.props.dispatch(B([])),e.props.dispatch(G([])),e.props.dispatch(P("")),e.props.dispatch(F("")),e.props.dispatch(W(null)),e.props.dispatch(Q(null)),e.props.dispatch(V(""))},e.getMessages=function(t){w.database().ref("messages/".concat(t)).orderByKey().limitToLast(e.props.quantityLoadMessages).on("value",(function(n){var a=n.val(),r=[];if(a&&("accepted"===a.requestStatus||a.request!==e.props.emailRedux||a.request===e.props.emailRedux&&"pending"===a.requestStatus)){for(var s in a)r.push({itemId:s,user:a[s].user,message:a[s].message,email:a[s].email,sent:a[s].sent,read:a[s].read,readTime:a[s].readTime});e.props.messagesRedux&&e.props.messagesRedux.length+14===Object.keys(r).length&&e.props.dispatch(k("No more messages")),e.props.currentChatIDRedux!==n.ref_.path.pieces_[1]&&e.props.currentChatIDRedux!==t||e.props.dispatch(N(r))}e.props.dispatch(U(!1))})),e.props.preventScrollDown||(document.getElementById("scroll-here").scrollIntoView(),e.props.dispatch(L(!1)))},e.login=function(){I.signInWithPopup(y).then((function(t){var n=t.user;e.setState({user:n,username:n.displayName}),w.database().ref("users").once("value",(function(t){var a=t.val(),r=0;for(var s in a)a[s].email===n.email&&r++;0===r&&e.addUserData(n.displayName,n.email,n.uid,n.photoURL)})),e.getUserInfo()}))},e.newMessageRoute=function(t){(function(){var n=Object(c.a)(i.a.mark((function n(){return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.props.dispatch(W(t));case 2:return n.next=4,e.getMessages(t);case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}})()()},e.test=function(){console.log(e.state.allUserEmails)},e.isChat=function(t){e.setState({isChat:t})},e}return Object(p.a)(n,[{key:"componentDidMount",value:function(){this.stayLoggedIn()}},{key:"render",value:function(){return r.a.createElement(Tt,null,this.props.userRedux?r.a.createElement(Nt,{className:"br1 br3 pa2 ma1 dib",onClick:this.logout},"Log Out | ",this.state.username):this.state.showLogInButton?r.a.createElement(Pt,null,r.a.createElement(Gt,null,"Messaging App"),r.a.createElement(qt,{onClick:this.login},"LOG IN")):null,this.props.userRedux?r.a.createElement("div",null,r.a.createElement(It,{getMessages:this.getMessages,newMessageRoute:this.newMessageRoute}),r.a.createElement(Lt,null,r.a.createElement(R,{isChat:this.isChat})),r.a.createElement(Bt,null,r.a.createElement(Ft,null,r.a.createElement(gt,{newMessageRoute:this.newMessageRoute}),r.a.createElement(_e,{newMessageRoute:this.newMessageRoute,getMessages:this.getMessages,usernameFunc:this.username,usernameState:this.state.username,removeItem:this.removeItem})),r.a.createElement(kt,null,this.state.isChat?r.a.createElement(_e,{newMessageRoute:this.newMessageRoute,getMessages:this.getMessages,usernameFunc:this.username,usernameState:this.state.username,removeItem:this.removeItem}):r.a.createElement(gt,{newMessageRoute:this.newMessageRoute})))):null)}}]),n}(a.Component),Qt=Object(_.b)((function(e){return{messagesRedux:e.app.messagesRedux,userRedux:e.app.userRedux,currentChatIDRedux:e.app.currentChatIDRedux,isMessageRequest:e.requests.isMessageRequest,emailRedux:e.app.emailRedux,quantityLoadMessages:e.app.quantityLoadMessages,preventScrollDown:e.app.preventScrollDown}}))(Wt);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Vt(){var e=Object(h.a)(["\n    // background-color: rgb(28,28,28);\n    background-color: rgb(18,18,23)\n    color: white;\n"]);return Vt=function(){return e},e}var Xt=f.a.div(Vt()),zt=(n(54),n(11)),Ht=n(3),Kt={userRedux:"",userIDRedux:"",currentChatIDRedux:null,emailRedux:"",newMessageOtherUserEmailRedux:"",allUserEmailsRedux:[],allCurrentUserEmailsRedux:[],allCurrentUserIDsRedux:[],messagesRedux:[],quantityLoadMessages:24,preventScrollDown:!1,loadMessagesText:"Load more messages",isMessagesLoading:!0};var Jt={isInboxTab:!0,allInfoInbox:[]};var Yt={messagesInboxRedux:[],allInfoRedux:[]};var $t={requestCount:0,isMessageRequest:!1};var Zt=Object(zt.combineReducers)({app:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"IS_MESSAGES_LOADING":return Object(Ht.a)(Object(Ht.a)({},e),{},{isMessagesLoading:t.payload});case"LOAD_MESSAGES_TEXT":return Object(Ht.a)(Object(Ht.a)({},e),{},{loadMessagesText:t.payload});case"PREVENT_SCROLL_DOWN":return Object(Ht.a)(Object(Ht.a)({},e),{},{preventScrollDown:t.payload});case"ADD_QUANTITY_LOAD_MESSAGES":return Object(Ht.a)(Object(Ht.a)({},e),{},{quantityLoadMessages:e.quantityLoadMessages+t.payload});case"ADD_MESSAGES":return Object(Ht.a)(Object(Ht.a)({},e),{},{messagesRedux:t.payload});case"ADD_ALL_CURRENT_USER_IDS":return Object(Ht.a)(Object(Ht.a)({},e),{},{allCurrentUserIDsRedux:t.payload});case"ADD_ALL_CURRENT_USER_EMAILS":return Object(Ht.a)(Object(Ht.a)({},e),{},{allCurrentUserEmailsRedux:t.payload});case"ADD_ALL_USER_EMAILS":return Object(Ht.a)(Object(Ht.a)({},e),{},{allUserEmailsRedux:t.payload});case"ADD_NEW_MESSAGE_OTHER_USER_EMAIL":return Object(Ht.a)(Object(Ht.a)({},e),{},{newMessageOtherUserEmailRedux:t.payload});case"ADD_EMAIL":return Object(Ht.a)(Object(Ht.a)({},e),{},{emailRedux:t.payload});case"ADD_CURRENT_CHAT_ID":return Object(Ht.a)(Object(Ht.a)({},e),{},{currentChatIDRedux:t.payload});case"ADD_USER":return Object(Ht.a)(Object(Ht.a)({},e),{},{userRedux:t.payload});case"ADD_USERID":return Object(Ht.a)(Object(Ht.a)({},e),{},{userID:t.payload});default:return e}},inbox:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Jt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"IS_INBOX_TAB":return Object(Ht.a)(Object(Ht.a)({},e),{},{isInboxTab:t.payload});case"ADD_ALL_INFO_INBOX":return Object(Ht.a)(Object(Ht.a)({},e),{},{allInfoInbox:t.payload});default:return e}},inboxContainer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_INBOX_MESSAGES":return Object(Ht.a)(Object(Ht.a)({},e),{},{messagesInboxRedux:t.payload});case"ADD_ALL_INFO":return Object(Ht.a)(Object(Ht.a)({},e),{},{allInfoRedux:t.payload});default:return e}},requests:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$t,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_REQUEST_COUNT":return Object(Ht.a)(Object(Ht.a)({},e),{},{requestCount:t.payload});case"IS_MESSAGE_REQUEST":return Object(Ht.a)(Object(Ht.a)({},e),{},{isMessageRequest:t.payload});default:return e}}}),en=n(34),tn=n(35),nn=Object(zt.createStore)(Zt,Object(tn.composeWithDevTools)(Object(zt.applyMiddleware)(en.a)));u.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(_.a,{store:nn},r.a.createElement(Xt,null,r.a.createElement(Qt,null)))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[36,1,2]]]);
//# sourceMappingURL=main.a916a649.chunk.js.map