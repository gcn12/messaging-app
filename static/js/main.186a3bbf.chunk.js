(this.webpackJsonpmessages=this.webpackJsonpmessages||[]).push([[0],{41:function(e,t,n){e.exports=n(63)},46:function(e,t,n){},63:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(27),u=n.n(s),o=(n(46),n(8)),i=n.n(o),c=n(15),l=n(10),p=n(11),d=n(13),m=n(12),h=(n(23),n(25),n(22)),f=n.n(h),g=(f.a.initializeApp({apiKey:"AIzaSyDVflBKJPhm5bNZfYL5yoqT66NfyiPQgT0",authDomain:"messages-598f6.firebaseapp.com",databaseURL:"https://messages-598f6.firebaseio.com",projectId:"messages-598f6",storageBucket:"messages-598f6.appspot.com",messagingSenderId:"1044285096751",appId:"1:1044285096751:web:f00b017ec43ce7dd2557da",measurementId:"G-KRSD66CD2T"}).firestore(),new f.a.auth.GoogleAuthProvider),v=f.a.auth(),b=f.a,x=n(14),R=n.n(x),O=n(2),E=n(3);function y(){var e=Object(O.a)(["\n    &:hover {\n        cursor: pointer\n    }\n"]);return y=function(){return e},e}function I(){var e=Object(O.a)(["\n    height: 5vh;\n    width: 93%;\n    background-color: grey;\n    border: none;\n    color: white;\n"]);return I=function(){return e},e}function D(){var e=Object(O.a)(["\n    margin-top: 10px;\n    display: flex;\n    width: 100%;\n"]);return D=function(){return e},e}var j=E.a.div(D()),w=E.a.textarea(I()),M=E.a.button(y()),S=n(6),C=function(e){return function(t){t({type:"LOAD_MESSAGES_TEXT",payload:e})}},A=function(e){return function(t){t({type:"PREVENT_SCROLL_DOWN",payload:e})}},U=function(e){return function(t){t({type:"ADD_QUANTITY_LOAD_MESSAGES",payload:e})}},_=function(e){return function(t){t({type:"ADD_MESSAGES",payload:e})}},k=function(e){return function(t){t({type:"ADD_ALL_CURRENT_USER_IDS",payload:e})}},T=function(e){return function(t){t({type:"ADD_ALL_CURRENT_USER_EMAILS",payload:e})}},L=function(e){return function(t){t({type:"ADD_ALL_USER_EMAILS",payload:e})}},N=function(e){return function(t){t({type:"ADD_NEW_MESSAGE_OTHER_USER_EMAIL",payload:e})}},q=function(e){return function(t){t({type:"ADD_EMAIL",payload:e})}},B=function(e){return function(t){t({type:"ADD_CURRENT_CHAT_ID",payload:e})}},G=function(e){return function(t){t({type:"ADD_USER",payload:e})}},P=function(e){return function(t){t({type:"ADD_USERID",payload:e})}},F=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={message:""},e.submitFunction=function(){var t,n,a,r,s,u;R.a.database().ref("users").once("value",(function(t){var n=e.props.allUserEmailsRedux.indexOf(e.props.newMessageOtherUserEmailRedux),o=Object.keys(t.val());a=o[n],-1!==n&&(r=t.val()[a].name,s=t.val()[a].photoURL,u=t.val()[a].email)}));var o=R.a.database().ref("users/".concat(e.props.userID,"/messages")),i=R.a.database().ref("users/".concat(a,"/messages"));if(0===e.props.messagesRedux.length){e.props.newMessageRoute();var c=R.a.database().ref("messages"),l={lastMessage:Date.now(),user1Photo:s,user2Photo:e.props.userRedux.photoURL,user1Email:u,user2Email:e.props.userRedux.email,user1:r,user2:e.props.userRedux.displayName,request:u,requestStatus:"pending"};c.push(l).then((function(a){n=a.path.pieces_.pop(),e.props.dispatch(B(n)),o.push({messageID:n,lastMessage:Date.now()}),i.push({messageID:n,lastMessage:Date.now()}),(t=R.a.database().ref("messages/".concat(n))).update({lastMessage:Date.now()});var r={user:e.props.usernameState,message:e.state.message,read:!1,email:e.props.emailRedux,sent:Date.now()};t.push(r),document.getElementById("message-input").value=""}))}else{if(/^(?!\s*$).+/.test(e.state.message)){(t=R.a.database().ref("messages/".concat(e.props.currentChatIDRedux))).once("value",(function(t){var n=t.val();n=Object.values(n),e.props.emailRedux!==n[n.length-2]?u=n[n.length-2]:e.props.emailRedux!==n[n.length-5]&&(u=n[n.length-5])})),e.props.dispatch(U(1));var p={user:e.props.usernameState,message:e.state.message,read:!1,email:e.props.emailRedux,sent:Date.now()};t.push(p),t.update({lastMessage:Date.now()}),R.a.database().ref("users").once("value",(function(e){for(var t in e.val())e.val()[t].email===u&&(a=t)})),o.once("value",(function(t){var n=t.val();for(var a in n){if(n[a].messageID===e.props.currentChatIDRedux)R.a.database().ref("users/".concat(e.props.userID,"/messages/").concat(a)).update({lastMessage:Date.now()})}})),(i=R.a.database().ref("users/".concat(a,"/messages"))).once("value",(function(t){for(var n in t.val()){if(t.val()[n].messageID===e.props.currentChatIDRedux)R.a.database().ref("users/".concat(a,"/messages/").concat(n)).update({lastMessage:Date.now()})}})),R.a.database().ref("users/".concat(e.props.userID)).update({lastUpdated:Date.now()}),e.setState({message:""}),document.getElementById("message-input").value=""}}},e.submitFunctionAsync=function(){(function(){var t=Object(c.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.submitFunction();case 2:return t.next=4,e.props.getMessages(e.props.currentChatIDRedux);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()},e.submit=function(t){t.keyCode?13!==t.keyCode||t.shiftKey||(t.preventDefault(),e.submitFunctionAsync()):e.submitFunctionAsync()},e.handleMessageChange=function(t){e.setState({message:t.target.value})},e.clearUnread=function(t){e.props.messagesRedux.length>0&&R.a.database().ref("messages/".concat(t)).once("value",(function(n){var a=n.val(),r=Object.keys(a),s=Object.values(a);r.reverse().splice(0,9),s.reverse().splice(0,9);for(var u=0,o=0,i=s;o<i.length;o++){var c=i[o];if(!1!==c.read)break;c.email!==e.props.emailRedux&&(R.a.database().ref("messages/".concat(t,"/").concat(r[u])).update({read:!0,readTime:Date.now()}),u++)}}))},e}return Object(p.a)(n,[{key:"render",value:function(){var e=this;return r.a.createElement(j,null,r.a.createElement(w,{className:"br3",onClick:function(){return e.clearUnread(e.props.currentChatIDRedux)},id:"message-input",onChange:this.handleMessageChange,placeholder:"enter message"}),r.a.createElement(M,{onClick:this.submit},"Send"))}},{key:"componentDidMount",value:function(){document.addEventListener("keypress",this.submit)}}]),n}(a.Component),W=Object(S.b)((function(e){return{messagesRedux:e.app.messagesRedux,emailRedux:e.app.emailRedux,allUserEmailsRedux:e.app.allUserEmailsRedux,currentChatIDRedux:e.app.currentChatIDRedux,newMessageOtherUserEmailRedux:e.app.newMessageOtherUserEmailRedux,userID:e.app.userID,userRedux:e.app.userRedux}}))(F);function Q(){var e=Object(O.a)(["\n    font-size: 10px;\n"]);return Q=function(){return e},e}function V(){var e=Object(O.a)(["\n    margin-top: 1rem;\n    background: rgb(70,70,70);\n    visibility: ",";\n"]);return V=function(){return e},e}function X(){var e=Object(O.a)(["\n    color: white;\n    border: none;\n    background-color: rgb(45, 45, 45);\n    &:hover {\n        cursor:pointer\n    }\n"]);return X=function(){return e},e}function z(){var e=Object(O.a)(["\n    display: flex;\n    flex-direction: column;\n"]);return z=function(){return e},e}function H(){var e=Object(O.a)(["\n    color: white;\n"]);return H=function(){return e},e}function K(){var e=Object(O.a)(["\n    color: white;\n    background-color: ",";\n    border: rgb(20,20,20) solid 1px;\n    max-width: 45%;\n    min-width: 15%;\n    word-wrap:break-word;\n    &:hover {\n        cursor: pointer\n    }\n"]);return K=function(){return e},e}function J(){var e=Object(O.a)(["\n    display: flex;\n    flex-direction: ",";\n    align-items: center;\n"]);return J=function(){return e},e}var Y=E.a.div(J(),(function(e){return e.isCurrentUser?"row-reverse":"row"})),$=E.a.div(K(),(function(e){return e.isCurrentUser?"rgb(45, 45, 45)":"rgb(80, 80, 80)"})),Z=E.a.div(H()),ee=E.a.div(z()),te=E.a.button(X()),ne=E.a.div(V(),(function(e){return e.showOptions?"null":"hidden"})),ae=E.a.div(Q()),re=n(30),se=n.n(re),ue=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={showOptions:!1},e.show=function(){e.setState({showOptions:!0})},e.hide=function(){e.setState({showOptions:!1})},e}return Object(p.a)(n,[{key:"render",value:function(){var e=this;return this.props.message?r.a.createElement(Y,{onMouseLeave:this.hide,isCurrentUser:this.props.emailRedux===this.props.email},r.a.createElement($,{isCurrentUser:this.props.emailRedux===this.props.email,onClick:this.show,className:this.props.user===this.props.userMessage?"current-user grow br3 pa3 ma1 dib bw2 shadow-5":"other-user grow br3 pa3 ma2 dib bw2 shadow-5"},"lastMessage"!==this.props.itemID&&"user1"!==this.props.itemID&&"user2"!==this.props.itemID&&"user2Photo"!==this.props.itemID&&"user1Photo"!==this.props.itemID&&"user2Email"!==this.props.itemID&&"user1Email"!==this.props.itemID?r.a.createElement("div",null,this.props.message,this.props.index===this.props.messagesQuantity-10&&this.props.readTime>0&&this.props.email===this.props.emailRedux?r.a.createElement(ae,null,"Seen ",se.a.unix(this.props.readTime/1e3).calendar().toLowerCase()):null):null),r.a.createElement(ne,{isCurrentUser:this.props.emailRedux===this.props.email,className:"br3 pa2 ma1 dib shadow-5",showOptions:this.state.showOptions},this.props.emailRedux===this.props.email?r.a.createElement(te,{onClick:function(){return e.props.removeItem(e.props.itemID)}},"Delete"):null,r.a.createElement("div",null,se.a.unix(Number(this.props.sent)/1e3).calendar()))):null}}]),n}(a.Component),oe=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).removeItem=function(t){b.database().ref("/messages/".concat(e.props.currentChatIDRedux,"/").concat(t)).remove()},e}return Object(p.a)(n,[{key:"render",value:function(){var e=this;return r.a.createElement(ee,null,"NEW MESSAGE"===this.props.currentChatIDRedux?r.a.createElement(Z,null,"Send new message to: ",this.props.newMessageOtherUserEmailRedux):null,this.props.messagesRedux.map((function(t,n){return r.a.createElement(ue,{messagesQuantity:e.props.messagesRedux.length,index:n,readTime:t.readTime,emailRedux:e.props.emailRedux,removeItem:e.removeItem,key:n,message:t.message,email:t.email,userMessage:t.user,itemID:t.itemId,sent:t.sent})})))}}]),n}(a.Component),ie=Object(S.b)((function(e){return{messagesRedux:e.app.messagesRedux,emailRedux:e.app.emailRedux,currentChatIDRedux:e.app.currentChatIDRedux,newMessageOtherUserEmailRedux:e.app.newMessageOtherUserEmailRedux}}))(oe),ce=function(e){return r.a.createElement("div",{style:{overflow:"scroll",border:"5px black",height:e.height,display:e.display,flexDirection:e.flexDirection}},e.children)};function le(){var e=Object(O.a)(["\n    color: white;\n    background-color: rgb(40,40,40);\n    border: none;\n"]);return le=function(){return e},e}function pe(){var e=Object(O.a)(["\n    display: flex;\n    justify-content: center;\n"]);return pe=function(){return e},e}function de(){var e=Object(O.a)(["\n    border: 5px solid rgb(30,30,30);\n    height: 81vh;\n    width: 50vw;\n"]);return de=function(){return e},e}var me=E.a.div(de()),he=E.a.div(pe()),fe=E.a.button(le()),ge=function(e){return function(t){t({type:"IS_INBOX_TAB",payload:e})}},ve=function(e){return function(t){t({type:"ADD_ALL_INFO_INBOX",payload:e})}},be=function(e){return function(t){t({type:"ADD_REQUEST_COUNT",payload:e})}},xe=function(e){return function(t){t({type:"IS_MESSAGE_REQUEST",payload:e})}};function Re(){var e=Object(O.a)(["\n    background-color: rgb(40,40,40);\n    color: white;\n    border: none;\n    justify-content: center;\n    &:hover{\n        cursor:pointer\n    }\n"]);return Re=function(){return e},e}function Oe(){var e=Object(O.a)(["\n    background-color: rgb(40,40,40);\n    color: white;\n    border: none;\n    justify-content: center;\n    &:hover{\n        cursor:pointer\n    }\n"]);return Oe=function(){return e},e}function Ee(){var e=Object(O.a)(["\n    display: flex;\n    width: 50vw;\n"]);return Ee=function(){return e},e}var ye=E.a.div(Ee()),Ie=E.a.button(Oe()),De=E.a.button(Re()),je=Object(S.b)((function(e){return{currentChatIDRedux:e.app.currentChatIDRedux,userID:e.app.userID,messagesRedux:e.app.messagesRedux,emailRedux:e.app.emailRedux}}))((function(e){var t=function(t){var n;b.database().ref("messages/".concat(e.currentChatIDRedux)).update({requestStatus:t}),b.database().ref("users/".concat(e.userID)).update({lastUpdated:Date.now()}),"accepted"===t?(e.dispatch(ge(!0)),e.dispatch(xe(!1)),n=e.currentChatIDRedux,e.messagesRedux.length>0&&b.database().ref("messages/".concat(n)).once("value",(function(t){var a=t.val(),r=Object.keys(a),s=Object.values(a);r.reverse().splice(0,9),s.reverse().splice(0,9);for(var u=0,o=0,i=s;o<i.length;o++){var c=i[o];if(!1!==c.read)break;c.email!==e.emailRedux&&(b.database().ref("messages/".concat(n,"/").concat(r[u])).update({read:!0,readTime:Date.now()}),u++)}}))):(e.dispatch(_([])),e.dispatch(B(null)))};return r.a.createElement(ye,null,r.a.createElement(Ie,{onClick:function(){return t("rejected")},className:"br2"},"Delete"),r.a.createElement(De,{onClick:function(){return t("accepted")},className:"br2"},"Accept"))})),we=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).loadMoreMessages=function(){(function(){var t=Object(c.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.props.dispatch(A(!0));case 2:return t.next=4,e.props.dispatch(U(15));case 4:return t.next=6,e.props.getMessages(e.props.currentChatIDRedux);case 6:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()},e}return Object(p.a)(n,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(me,{className:"message-container"},r.a.createElement(ce,{height:"79vh"},this.props.messagesRedux.length>23?r.a.createElement(he,null,r.a.createElement(fe,{onClick:this.loadMoreMessages},this.props.loadMessagesText)):null,r.a.createElement(ie,{removeItem:this.props.removeItem,user:this.props.usernameState}),r.a.createElement("div",{id:"scroll-here"}))),null!==this.props.currentChatIDRedux?this.props.isMessageRequest?r.a.createElement(je,null):r.a.createElement(W,{newMessageRoute:this.props.newMessageRoute,usernameState:this.props.usernameState,getMessages:this.props.getMessages,usernameFunc:this.props.username}):null)}}]),n}(a.Component),Me=Object(S.b)((function(e){return{currentChatIDRedux:e.app.currentChatIDRedux,messagesRedux:e.app.messagesRedux,isMessageRequest:e.requests.isMessageRequest,loadMessagesText:e.app.loadMessagesText}}))(we),Se=n(20);function Ce(){return(Ce=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Ae(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var Ue=r.a.createElement("circle",{cx:20,cy:20,r:16,fill:"rgb(26, 26, 26)"}),_e=function(e){var t=e.svgRef,n=e.title,a=Ae(e,["svgRef","title"]);return r.a.createElement("svg",Ce({height:40,width:40,ref:t},a),n?r.a.createElement("title",null,n):null,Ue)},ke=r.a.forwardRef((function(e,t){return r.a.createElement(_e,Ce({svgRef:t},e))}));n.p;function Te(){var e=Object(O.a)(["\n    position: absolute;\n"]);return Te=function(){return e},e}function Le(){var e=Object(O.a)(["\n\n"]);return Le=function(){return e},e}function Ne(){var e=Object(O.a)(["\n    float: right;\n    width: 25%;\n    position: relative;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n"]);return Ne=function(){return e},e}function qe(){var e=Object(O.a)(["\n    word-wrap:break-word;\n"]);return qe=function(){return e},e}function Be(){var e=Object(O.a)(["\n    font-size: 20px;\n"]);return Be=function(){return e},e}function Ge(){var e=Object(O.a)(["\n    float: left;\n    width: 50%;\n    height: 50%;\n"]);return Ge=function(){return e},e}function Pe(){var e=Object(O.a)(["\n    padding-left: 10px;\n    height: 60px;\n    width: 60px;\n"]);return Pe=function(){return e},e}function Fe(){var e=Object(O.a)(["\n    width: 25%;\n    float: left;\n    align-items: center;\n"]);return Fe=function(){return e},e}function We(){var e=Object(O.a)(["\n    height: 90px;\n    cursor: pointer;\n    border: solid rgb(5,5,5) 1px;\n    background-color: "," ;\n    color: white;\n    display: flex;\n    width: 97%;\n"]);return We=function(){return e},e}var Qe=E.a.div(We(),(function(e){return e.isCurrentThread?"rgb(100,100,100) ":"rgb(40,40,40)"})),Ve=E.a.div(Fe()),Xe=E.a.img(Pe()),ze=E.a.div(Ge()),He=E.a.div(Be()),Ke=E.a.div(qe()),Je=E.a.div(Ne()),Ye=(Object(E.a)(ke)(Le()),E.a.div(Te())),$e=function(e,t){var n=0;return e.lastMessage<t.lastMessage?n=1:e.lastMessage>t.lastMessage&&(n=-1),n},Ze=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={messages:[],allInfo:[]},e.getMessageSummaries=function(){var t=b.auth().currentUser;b.database().ref("users/".concat(t.uid)).on("value",(function(n){var a=n.val();a&&a.messages&&function(){var n=Object.values(a.messages);n=n.sort($e);var r,s=[],u=[],o=[],i=[],c={},l=Object(Se.a)(n);try{var p=function(){var n=r.value,a=0,l=b.database().ref("messages/".concat(n.messageID)),p=void 0;l.on("value",(function(r){if(r.val()){var l={};p=Object.values(r.val());var d=Object.values(r.val());d.reverse().splice(0,9);for(var m=0,h=0,f=d;h<f.length;h++){var g=f[h];if(!1!==g.read)break;g.email!==t.email&&m++}var v,b,x=Object.values(r.val());v=x[x.length-3]===t.displayName?x[x.length-6]:x[x.length-3],b=x[x.length-1]===t.photoURL?x[x.length-4]:x[x.length-1],x[x.length-2]===t.email?i.push(x[x.length-5]):i.push(x[x.length-2]),(p=p[p.length-10])&&(p=Object.values(p)[1]).length+p.split(" ").length>31&&(p=p.slice(0,31),p+="..."),o.push(n.messageID),l.message=p,l.photoURL=b,l.displayName=v,l.unread=m,"accepted"!==r.val().requestStatus&&r.val().request===e.props.emailRedux||(c[n.messageID]=l,e.setState({allInfo:c}),e.props.dispatch(ve(c)),s.push(n.messageID)),r.val().request===e.props.emailRedux&&"pending"===r.val().requestStatus?u.push(n.messageID):a>-1?null===e.props.currentChatIDRedux&&("rejected"===r.val().requestStatus&&r.val().request===e.props.emailRedux||(e.props.newMessageRoute(n.messageID),a=-1)):a++,e.props.dispatch(be(u.length))}})),e.props.dispatch(T(i)),e.props.dispatch(k(o))};for(l.s();!(r=l.n()).done;)p()}catch(d){l.e(d)}finally{l.f()}e.props.messagesRedux.length>=s.length+u.length&&document.getElementById("scroll-here").scrollIntoView(),e.setState({messages:s})}()}))},e.test=function(){console.log(Object.values(e.state.allInfo))},e.inboxToMessages=function(t){e.props.newMessageRoute(t),b.database().ref("messages/".concat(t)).on("value",(function(n){if(n.val()){var a=n.val(),r=Object.keys(a),s=Object.values(a);r.reverse().splice(0,8),s.reverse().splice(0,8),s.map((function(n,a){!1===n.read&&(n.email!==e.props.emailRedux&&b.database().ref("messages/".concat(t,"/").concat(r[a])).update({read:!0,readTime:Date.now()}));return null})),document.getElementById("scroll-here").scrollIntoView()}}))},e.inboxToMessagesAsync=function(t){(function(){var n=Object(c.a)(i.a.mark((function n(){return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.props.dispatch(xe(!1));case 2:return n.next=4,e.inboxToMessages(t);case 4:return n.next=6,document.getElementById("scroll-here").scrollIntoView();case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}})()()},e.getMessageSummariesAsync=function(){(function(){var t=Object(c.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.props.dispatch(be(0));case 2:return t.next=4,e.getMessageSummaries();case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()},e}return Object(p.a)(n,[{key:"componentDidMount",value:function(){this.getMessageSummariesAsync()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,Object.values(this.props.allInfoInbox).map((function(t,n){return r.a.createElement(Qe,{className:"br3 pa3 ma2",isCurrentThread:e.props.currentChatIDRedux===e.state.messages[n],onClick:function(){return e.inboxToMessagesAsync(e.state.messages[n])},key:n},r.a.createElement(Ve,null,r.a.createElement(Xe,{alt:"user profile",src:t.photoURL})),r.a.createElement(ze,null,r.a.createElement(He,null,t.displayName),r.a.createElement(Ke,null,t.message)),t.unread>0?r.a.createElement(Je,null,r.a.createElement(ke,null),r.a.createElement(Ye,null,t.unread)):null)})))}}]),n}(a.Component),et=Object(S.b)((function(e){return{currentChatIDRedux:e.app.currentChatIDRedux,emailRedux:e.app.emailRedux,isInboxTab:e.inbox.isInboxTab,requestCount:e.requests.requestCount,allInfoInbox:e.inbox.allInfoInbox,messagesRedux:e.app.messagesRedux,userRedux:e.app.userRedux}}))(Ze),tt=function(e,t){var n=0;return e.lastMessage<t.lastMessage?n=1:e.lastMessage>t.lastMessage&&(n=-1),n},nt=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={messages:[],allInfo:[]},e.getMessageSummaries=function(){var t=b.auth().currentUser;b.database().ref("users/".concat(t.uid)).on("value",(function(n){var a=n.val();a&&a.messages&&function(){var n=Object.values(a.messages);n=n.sort(tt);var r,s=[],u=[],o=[],i={},c=Object(Se.a)(n);try{var l=function(){var n=r.value,a=b.database().ref("messages/".concat(n.messageID)),c=void 0;a.on("value",(function(a){if(a.val()){var r={};c=Object.values(a.val());var l,p,d=Object.values(a.val());d[d.length-3]===t.displayName?l=d[d.length-6]:d[d.length-6]===t.displayName&&(l=d[d.length-3]),d[d.length-1]===t.photoURL?p=d[d.length-4]:d[d.length-4]===t.photoURL&&(p=d[d.length-1]),d[d.length-2]===t.email?o.push(d[d.length-5]):d[d.length-5]===t.email&&o.push(d[d.length-2]),(c=c[c.length-10])&&(c=Object.values(c)[1]).length+c.split(" ").length>31&&(c=c.slice(0,31),c+="..."),u.push(n.messageID),r.message=c,r.photoURL=p,r.displayName=l,r.unread=0,a.val().request===e.props.emailRedux&&"pending"===a.val().requestStatus&&(i[n.messageID]=r,e.setState({allInfo:i}),s.push(n.messageID))}document.getElementById("scroll-here").scrollIntoView()})),e.props.dispatch(T(o)),e.props.dispatch(k(u))};for(c.s();!(r=c.n()).done;)l()}catch(p){c.e(p)}finally{c.f()}e.setState({messages:s})}()}))},e.test=function(){},e.inboxToMessagesAsync=function(t){(function(){var n=Object(c.a)(i.a.mark((function n(){return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.props.dispatch(xe(!0));case 2:return n.next=4,e.props.newMessageRoute(t);case 4:return n.next=6,document.getElementById("scroll-here").scrollIntoView();case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}})()()},e}return Object(p.a)(n,[{key:"componentDidMount",value:function(){this.getMessageSummaries()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,this.state.messages.length>0?r.a.createElement("div",null,this.props.isInboxTab?r.a.createElement("div",null,"Hellooo"):Object.values(this.state.allInfo).map((function(t,n){return r.a.createElement(Qe,{className:"br3 pa3 ma2",isCurrentThread:e.props.currentChatIDRedux===e.state.messages[n],onClick:function(){return e.inboxToMessagesAsync(e.state.messages[n])},key:n},r.a.createElement(Ve,null,r.a.createElement(Xe,{alt:"user profile",src:t.photoURL})),r.a.createElement(ze,null,r.a.createElement(He,null,t.displayName),r.a.createElement(Ke,null,t.message)))}))):null)}}]),n}(a.Component),at=Object(S.b)((function(e){return{currentChatIDRedux:e.app.currentChatIDRedux,emailRedux:e.app.emailRedux,isInboxTab:e.inbox.isInboxTab}}))(nt);function rt(){var e=Object(O.a)(["\n    &:hover {\n        cursor: pointer;\n    };\n    text-decoration: ","\n"]);return rt=function(){return e},e}function st(){var e=Object(O.a)(["\n    &:hover {\n        cursor: pointer\n    };\n    text-decoration: ","\n"]);return st=function(){return e},e}function ut(){var e=Object(O.a)(["\n    display: flex;\n    color: white;\n    justify-content: space-evenly;\n"]);return ut=function(){return e},e}function ot(){var e=Object(O.a)(["\nwidth: 30vw;\nheight: 86vh; \n"]);return ot=function(){return e},e}var it=E.a.div(ot()),ct=E.a.div(ut()),lt=E.a.div(st(),(function(e){return e.isSelected?"underline":"null"})),pt=E.a.div(rt(),(function(e){return e.isSelected?"null":"underline"})),dt=Object(S.b)((function(e){return{isInboxTab:e.inbox.isInboxTab,requestCount:e.requests.requestCount}}))((function(e){return r.a.createElement("div",null,r.a.createElement(ct,null,r.a.createElement(lt,{isSelected:e.isInboxTab,onClick:function(){return e.dispatch(ge(!0))}},"Inbox"),r.a.createElement(pt,{isSelected:e.isInboxTab,onClick:function(){return e.dispatch(ge(!1))}},"Requests (",e.requestCount,")")),e.isInboxTab?r.a.createElement(ce,{height:"88vh"},r.a.createElement(it,null,r.a.createElement(et,{newMessageRoute:e.newMessageRoute}))):r.a.createElement(ce,{height:"88vh"},r.a.createElement(it,null,r.a.createElement(at,{newMessageRoute:e.newMessageRoute}))))}));function mt(){var e=Object(O.a)(["\n    color: white;\n"]);return mt=function(){return e},e}function ht(){var e=Object(O.a)(["\n    height: 30px;\n    width: 200px;\n    cursor: pointer;\n    background-color: gray;\n    color: white;\n    border: none;\n    margin: 0 5px 0 10px;\n"]);return ht=function(){return e},e}function ft(){var e=Object(O.a)(["\n    height: 35px;\n    width: 3vw;\n    cursor: pointer;\n    background-color: rgb(50,50,50);\n    color: white;\n    border: none;\n"]);return ft=function(){return e},e}var gt=E.a.button(ft()),vt=E.a.input(ht()),bt=E.a.div(mt()),xt=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={email:"",isUserExist:""},e.handleEmail=function(t){e.setState({email:t.target.value})},e.createNewMessage=function(){if(e.state.email.length>0){var t=e.props.allCurrentUserEmailsRedux.indexOf(e.state.email);if(-1!==t)e.props.getMessages(e.props.allCurrentUserIDsRedux[t]),e.props.dispatch(B(e.props.allCurrentUserIDsRedux[t])),"user does not exist"===e.state.isUserExist&&e.setState({isUserExist:""});else{var n,a=Object(Se.a)(e.props.allUserEmailsRedux);try{for(a.s();!(n=a.n()).done;){var r=n.value;if(e.state.email===e.props.emailRedux)break;if(r===e.state.email){e.props.dispatch(_([])),e.props.dispatch(B("NEW MESSAGE")),e.props.dispatch(N(e.state.email)),e.setState({isUserExist:""});break}e.setState({isUserExist:"user does not exist"})}}catch(s){a.e(s)}finally{a.f()}}document.getElementById("email-input").value=""}},e}return Object(p.a)(n,[{key:"render",value:function(){return r.a.createElement(bt,null,r.a.createElement(vt,{className:"br2",id:"email-input",onChange:this.handleEmail,placeholder:"enter email"}),r.a.createElement(gt,{className:"br2",onClick:this.createNewMessage},"+"),r.a.createElement("div",null,this.state.isUserExist))}}]),n}(a.Component),Rt=Object(S.b)((function(e){return{allUserEmailsRedux:e.app.allUserEmailsRedux,emailRedux:e.app.emailRedux,allCurrentUserEmailsRedux:e.app.allCurrentUserEmailsRedux,allCurrentUserIDsRedux:e.app.allCurrentUserIDsRedux}}))(xt);function Ot(){var e=Object(O.a)(["\n"]);return Ot=function(){return e},e}function Et(){var e=Object(O.a)(["\n    font-size: 6vw;\n    color: white;\n    font-family: 'Lato';\n    position: absolute;\n    top: 45%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n"]);return Et=function(){return e},e}function yt(){var e=Object(O.a)(["\n    display: flex;\n"]);return yt=function(){return e},e}function It(){var e=Object(O.a)(["\n    border: none;\n    height: 5vh;\n    width: 20vw;\n    color: white;\n    cursor: pointer;\n    background-color: rgb(18, 208, 255);\n    position: absolute;\n    top: 55%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    font-family: 'Lato';\n    font-size: 2vw;\n    &:hover {\n        background-color: green;\n    }\n"]);return It=function(){return e},e}function Dt(){var e=Object(O.a)(["\n    border: none;\n    color: white;\n    cursor: pointer;\n    background-color: rgb(80, 80, 80);\n    margin: 5px 5px 5px 10px;\n"]);return Dt=function(){return e},e}function jt(){var e=Object(O.a)(["\n    width: 100%;\n"]);return jt=function(){return e},e}var wt=E.a.div(jt()),Mt=E.a.button(Dt()),St=E.a.button(It()),Ct=E.a.div(yt()),At=E.a.div(Et()),Ut=E.a.div(Ot()),_t=function(e){Object(d.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(l.a)(this,n);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={username:""},e.username=function(t){e.setState({username:t.target.value})},e.stayLoggedIn=function(){v.onAuthStateChanged((function(t){t&&(e.setState({username:t.displayName}),e.props.dispatch(q(t.email)),e.props.dispatch(P(t.uid)),e.props.dispatch(G(t)),e.getUserInfo())}))},e.getUserInfo=function(){b.database().ref("users").on("value",(function(t){var n=t.val(),a=[];for(var r in n)a.push(n[r].email);e.props.dispatch(L(a))}))},e.addUserData=function(e,t,n,a){var r={name:e,email:t,dateCreated:Date.now(),photoURL:a};b.database().ref("users/".concat(n)).set(r)},e.removeItem=function(t){b.database().ref("/messages/".concat(e.props.currentChatIDRedux,"/").concat(t)).remove()},e.logout=function(){v.signOut(),e.props.dispatch(_([])),e.props.dispatch(k([])),e.props.dispatch(T([])),e.props.dispatch(L([])),e.props.dispatch(N("")),e.props.dispatch(q("")),e.props.dispatch(B(null)),e.props.dispatch(G(null)),e.props.dispatch(P(""))},e.getMessages=function(t){b.database().ref("messages/".concat(t)).orderByKey().limitToLast(e.props.quantityLoadMessages).on("value",(function(n){var a=n.val(),r=[];if(a&&("accepted"===a.requestStatus||a.request!==e.props.emailRedux||a.request===e.props.emailRedux&&"pending"===a.requestStatus)){for(var s in a)r.push({itemId:s,user:a[s].user,message:a[s].message,email:a[s].email,sent:a[s].sent,read:a[s].read,readTime:a[s].readTime});e.props.messagesRedux&&(console.log("messages",e.props.messagesRedux.length),console.log("newstate",r.length),e.props.messagesRedux.length+14===Object.keys(r).length&&e.props.dispatch(C("No more messages"))),e.props.currentChatIDRedux!==n.ref_.path.pieces_[1]&&e.props.currentChatIDRedux!==t||e.props.dispatch(_(r))}})),e.props.preventScrollDown||(document.getElementById("scroll-here").scrollIntoView(),e.props.dispatch(A(!1)))},e.login=function(){v.signInWithPopup(g).then((function(t){var n=t.user;e.setState({user:n,username:n.displayName}),b.database().ref("users").once("value",(function(t){var a=t.val(),r=0;for(var s in a)a[s].email===n.email&&r++;0===r&&e.addUserData(n.displayName,n.email,n.uid,n.photoURL)})),e.getUserInfo()}))},e.newMessageRoute=function(t){(function(){var n=Object(c.a)(i.a.mark((function n(){return i.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.props.dispatch(B(t));case 2:return n.next=4,e.getMessages(t);case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}})()()},e.test=function(){console.log(e.state.allUserEmails)},e}return Object(p.a)(n,[{key:"componentDidMount",value:function(){this.stayLoggedIn()}},{key:"render",value:function(){return r.a.createElement(wt,null,this.props.userRedux?r.a.createElement(Mt,{className:"br1 br3 pa2 ma1 dib",onClick:this.logout},"Log Out | ",this.state.username):r.a.createElement(Ut,null,r.a.createElement(At,null,"Messaging App"),r.a.createElement(St,{onClick:this.login},"LOG IN")),this.props.userRedux?r.a.createElement("div",null,r.a.createElement(Rt,{getMessages:this.getMessages,newMessageRoute:this.newMessageRoute}),r.a.createElement(Ct,null,r.a.createElement(dt,{newMessageRoute:this.newMessageRoute}),r.a.createElement(Me,{newMessageRoute:this.newMessageRoute,getMessages:this.getMessages,usernameFunc:this.username,usernameState:this.state.username,removeItem:this.removeItem}))):null)}}]),n}(a.Component),kt=Object(S.b)((function(e){return{messagesRedux:e.app.messagesRedux,userRedux:e.app.userRedux,currentChatIDRedux:e.app.currentChatIDRedux,isMessageRequest:e.requests.isMessageRequest,emailRedux:e.app.emailRedux,quantityLoadMessages:e.app.quantityLoadMessages,preventScrollDown:e.app.preventScrollDown}}))(_t);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Tt(){var e=Object(O.a)(["\n    // background-color: rgb(28,28,28);\n    background-color: rgb(18,18,23)\n    color: white;\n"]);return Tt=function(){return e},e}var Lt=E.a.div(Tt()),Nt=(n(62),n(16)),qt=n(4),Bt={userRedux:"",userIDRedux:"",currentChatIDRedux:null,emailRedux:"",newMessageOtherUserEmailRedux:"",allUserEmailsRedux:[],allCurrentUserEmailsRedux:[],allCurrentUserIDsRedux:[],messagesRedux:[],quantityLoadMessages:24,preventScrollDown:!1,loadMessagesText:"Load more messages"};var Gt={isInboxTab:!0,allInfoInbox:[]};var Pt={messagesInboxRedux:[],allInfoRedux:[]};var Ft={requestCount:0,isMessageRequest:!1};var Wt=Object(Nt.combineReducers)({app:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Bt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOAD_MESSAGES_TEXT":return Object(qt.a)(Object(qt.a)({},e),{},{loadMessagesText:t.payload});case"PREVENT_SCROLL_DOWN":return Object(qt.a)(Object(qt.a)({},e),{},{preventScrollDown:t.payload});case"ADD_QUANTITY_LOAD_MESSAGES":return Object(qt.a)(Object(qt.a)({},e),{},{quantityLoadMessages:e.quantityLoadMessages+t.payload});case"ADD_MESSAGES":return Object(qt.a)(Object(qt.a)({},e),{},{messagesRedux:t.payload});case"ADD_ALL_CURRENT_USER_IDS":return Object(qt.a)(Object(qt.a)({},e),{},{allCurrentUserIDsRedux:t.payload});case"ADD_ALL_CURRENT_USER_EMAILS":return Object(qt.a)(Object(qt.a)({},e),{},{allCurrentUserEmailsRedux:t.payload});case"ADD_ALL_USER_EMAILS":return Object(qt.a)(Object(qt.a)({},e),{},{allUserEmailsRedux:t.payload});case"ADD_NEW_MESSAGE_OTHER_USER_EMAIL":return Object(qt.a)(Object(qt.a)({},e),{},{newMessageOtherUserEmailRedux:t.payload});case"ADD_EMAIL":return Object(qt.a)(Object(qt.a)({},e),{},{emailRedux:t.payload});case"ADD_CURRENT_CHAT_ID":return Object(qt.a)(Object(qt.a)({},e),{},{currentChatIDRedux:t.payload});case"ADD_USER":return Object(qt.a)(Object(qt.a)({},e),{},{userRedux:t.payload});case"ADD_USERID":return Object(qt.a)(Object(qt.a)({},e),{},{userID:t.payload});default:return e}},inbox:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Gt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"IS_INBOX_TAB":return Object(qt.a)(Object(qt.a)({},e),{},{isInboxTab:t.payload});case"ADD_ALL_INFO_INBOX":return Object(qt.a)(Object(qt.a)({},e),{},{allInfoInbox:t.payload});default:return e}},inboxContainer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Pt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_INBOX_MESSAGES":return Object(qt.a)(Object(qt.a)({},e),{},{messagesInboxRedux:t.payload});case"ADD_ALL_INFO":return Object(qt.a)(Object(qt.a)({},e),{},{allInfoRedux:t.payload});default:return e}},requests:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ft,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_REQUEST_COUNT":return Object(qt.a)(Object(qt.a)({},e),{},{requestCount:t.payload});case"IS_MESSAGE_REQUEST":return Object(qt.a)(Object(qt.a)({},e),{},{isMessageRequest:t.payload});default:return e}}}),Qt=n(39),Vt=n(40),Xt=Object(Nt.createStore)(Wt,Object(Vt.composeWithDevTools)(Object(Nt.applyMiddleware)(Qt.a)));u.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(S.a,{store:Xt},r.a.createElement(Lt,null,r.a.createElement(kt,null)))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[41,1,2]]]);
//# sourceMappingURL=main.186a3bbf.chunk.js.map